sap.ui.define(["./BaseController","sap/ui/core/library","../utils/formatter","sap/m/MessageBox"],function(e,t,o,r){"use strict";const{UIComponent:s,ValueState:a,BusyIndicator:l}=t;return e.extend("com.zeffortcalculator.controller.Calculate",{formatter:o,onInit:function(){this.getView().addEventDelegate({onAfterShow:()=>{this.getView().byId("hclImg").attachPress(()=>{this.onHome()})}});var e=s.getRouterFor(this);e.getRoute("Calculate").attachPatternMatched(this._onObjectFetched,this)},_onObjectFetched:function(){this.getView().loaded().then(()=>{this.getOwnerModel("pgUiData").setProperty("/showBaseLines",false);if(this.getOwnerModel("oModelEstCal").getProperty("/SsDbSize")){this.getView().byId("SsDbSize").fireChange({value:this.getOwnerModel("oModelEstCal").getProperty("/SsDbSize")});this.getOwnerModel("oModelEstCal").setProperty("/SaveOrEdit","")}});this.getView().byId("CalculateButtons").setVisible(false);this.getView().byId("CalculateButtons").setVisible(true)},onHome:function(){this.getView().byId("CalculateButtons").setVisible(false);this.getRouter().navTo("Home",{},false)},onCommentsLength:function(e){if(e.getSource().getValue().length>+e.getSource().getMaxLength()){e.getSource().setValue(e.getSource().getValue().substring(0,+e.getSource().getMaxLength()));return false}const t=this.specialCharacterCheck(e.getSource().getValue());if(!t){e.getSource().setValue(e.getSource().getValue().slice(0,e.getSource().getValue().length-1))}},onRangeInfo:function(e,t){let o=+this.getOwnerModel("oModelEstCal").getProperty("/"+t);let s=+this.getOwnerModel("oModelSelectedBaseLine").getProperty("/"+t);let a=+this.getOwnerModel("rangeData").getProperty("/"+t);let l="";switch(t){case"SimComplexFm":l=` \n\nNote: The typical Complexity of SAP Modules has been categorized as below. This will vary from Industry type: \n Low ðŸ¡ª SD,HCM,PP, PS ,PM, QM`;break;case"MedComplexFm":l=` \n\nNote: The typical Complexity of SAP Modules has been categorized as below. This will vary from Industry type: \n Medium ðŸ¡ª MM , PP \n`;break;case"HighComplexFm":l=` \n\nNote: The typical Complexity of SAP Modules has been categorized as below. This will vary from Industry type: \n High ðŸ¡ª FICO & CVI \n`;break;default:break}r.information(`The difference between entered value and baseline value should be less than or equal to the range value. \n\n\t\t\t\t\t Entered value(${o}) - Baseline(${s}) <= Range value(${a})\n\t\t\t\t\t ${l}`)},checkwithBaseLine:function(e,t){if(e.getSource().getValue().includes(".")){e.preventDefault();e.getSource().setValue(+e.getSource().getValue().split(".").join(""))}let o=this.getOwnerModel("oModelSelectedBaseLine").getData()[t];let r=this.getOwnerModel("rangeData").getData()[t];let s=+e.getSource().getValue();e.getSource().setValueState(a.None);if(s<0){e.getSource().setValue();return}if(!(+o-r<=s&&s<=+o+r)){e.getSource().setValueState(a.Error);this.getOwnerModel("pgUiData").setProperty("/errors",true)}else this.getOwnerModel("pgUiData").setProperty("/errors",false);e.getSource().setValueStateText("")},onDBChange:function(e){let t=this.getOwnerModel("oModelEstCal").getProperty("/OppType");let o=parseFloat(e.getSource().getValue());let r=this.getOwnerModel("oModelBaseLineDataSet").getData();if(o){e.getSource().setValueState(a.None);e.getSource().setValueStateText("");this.getOwnerModel("pgUiData").setProperty("/errors",false);this.getOwnerModel("pgUiData").setProperty("/showBaseLines",true);if(o>0&&o<=3){this.getOwnerModel("oModelEstCal").setProperty("/SystemSize","S")}else if(o>3&&o<=6){this.getOwnerModel("oModelEstCal").setProperty("/SystemSize","M")}else if(o>6&&o<=10){this.getOwnerModel("oModelEstCal").setProperty("/SystemSize","L")}else{this.getOwnerModel("oModelEstCal").setProperty("/SystemSize","");e.getSource().setValueState(a.Error);e.getSource().setValueStateText("Maximum size 10 TB");this.getOwnerModel("pgUiData").setProperty("/errors",true);this.getOwnerModel("pgUiData").setProperty("/showBaseLines",false)}}else{e.getSource().setValueState(a.Error);e.getSource().setValueStateText("System Size cannot be 0");this.getOwnerModel("pgUiData").setProperty("/errors",true)}this.getOwnerModel("oModelEstCal").setProperty("/SsDbSize",o.toFixed(3));if(t&&o){let e=r.filter(e=>e.OppTypeWp==t&&e.SystemSize==this.getOwnerModel("oModelEstCal").getProperty("/SystemSize"));this.getOwnerModel("oModelSelectedBaseLine").setData(e[0])}let s=["NoOfCycles","HighComplexFm","MedComplexFm","SimComplexFm","AtcViolCount","FioriStdAppCount","FioriSecCatRole","SecMasterRole","InterfaceCount"];let l=this.getOwnerModel("oModelSelectedBaseLine").getData();if(this.getOwnerModel("oModelEstCal").getProperty("/SaveOrEdit")!="E"){s.forEach(e=>{this.getOwnerModel("oModelEstCal").setProperty("/"+e,+l[e])})}},onCalculate:function(){let e=this.getOwnerModel("pgUiData").getProperty("/loggedInUserEmail");let t=this.getOwnerModel("pgUiData").getProperty("/loggedInUser");this.getOwnerModel("oModelEstCal").setProperty("/Email",e);this.getOwnerModel("oModelEstCal").setProperty("/SuserId",t);let s=this.getOwnerModel("oModelEstCal").getData();if(s.SsDbSize==""||s.NoOfCycles==""){r.error("Please provide mendatory data");return}this.validateInputs();if(this.getOwnerModel("pgUiData").getProperty("/errors")){r.error("Please provide valid data");return}s=o.changeDataTypes(this.getOwnerModel(),s);delete s.to_Baseline;delete s.to_Config;delete s.to_Opp;delete s.to_PlatformEffort;delete s.to_PlatformEffortHD;delete s.to_ResourceEff;delete s.to_TotalEffort;l.show();let a=this.callBackEnd("/zi_hcl_header","POST",[],s);a.then(e=>{console.log(e);l.hide();if(JSON.parse(e.headers["sap-message"])?.severity=="error"){r.information(JSON.parse(e.headers["sap-message"]).message);return}let t=e.data;this.getOwnerModel("oModelEstCal").setData(null);this.getOwnerModel("oModelEstCal").setData(t);if(t.OpportunityId&&+t.OpportunityId<=0){r.error("No Opportunity Id has been created.");return}r.success("Successfully Saved",{actions:[r.Action.OK],emphasizedAction:r.Action.OK,onClose:()=>{this.getRouter().navTo("Detail",{CustId:t.CustId.trim(),OpportunityId:t.OpportunityId.trim(),Version:t.Version.trim()},false);return}})}).catch(e=>{l.hide();console.log(e)})},onNegativeCheck:function(e){let t=e.getSource().getValue();if(+t<0){e.preventDefault();e.getSource().setValue(+t.slice(0,-1));return}},onReset:function(){let e=this.getOwnerModel("oModelEstCal");e.setProperty("/SsDbSize","");e.setProperty("/NoOfCycles","");e.setProperty("/HighComplexFm","");e.setProperty("/MedComplexFm","");e.setProperty("/SimComplexFm","");e.setProperty("/AtcViolCount","");e.setProperty("/FioriStdAppCount","");e.setProperty("/FioriSecCatRole","");e.setProperty("/SecMasterRole","");e.setProperty("/InterfaceCount","");e.setProperty("/Comments","");e.setProperty("/SaveOrEdit","");this.getOwnerModel("pgUiData").setProperty("/showBaseLines",false)},specialCharacterCheck:function(e){const t=/^[a-zA-Z0-9 .]+$/;if(!t.test(e))return false;else return true},validateInputs:function(){let e=this.getOwnerModel("oModelSelectedBaseLine").getData(),t=this.getOwnerModel("rangeData").getData();let o=["NoOfCycles","HighComplexFm","MedComplexFm","SimComplexFm","AtcViolCount","FioriStdAppCount","FioriSecCatRole","SecMasterRole","InterfaceCount"];let r=0;o.forEach(o=>{this.getView().byId(o).setValueState(a.None);if(this.getView().byId(o).getValue()){if(!(+e[o]-t[o]<=+this.getView().byId(o).getValue()&&+this.getView().byId(o).getValue()<=+e[o]+t[o])){this.getView().byId(o).setValueState(a.Error);r+=1}}else{this.getView().byId(o).setValueState(a.Error);r+=1}});if(r>0){this.getOwnerModel("pgUiData").setProperty("/errors",true);return}this.getOwnerModel("pgUiData").setProperty("/errors",false)}})});
//# sourceMappingURL=Calculate.controller.js.map